<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>時間割</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
    }

    th, td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }

    th {
      position: sticky;
      background: white;
      z-index: 2;
    }

    th:first-child {
      left: 0;
      z-index: 3;
    }

    tr:first-child th {
      top: 0;
    }

    td:first-child {
      position: sticky;
      left: 0;
      background: white;
      z-index: 1;
    }

    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch; /* iOS慣性スクロール対応 */
    }

/* 画面幅600px以下のときの調整 */
    @media screen and (max-width: 600px) {
      body {
        font-size: 14px;
      }
      table {
        font-size: 12px;
      }
      th, td {
        padding: 6px;
      }
  /* ボタンを幅いっぱいにして押しやすく */
      button {
        width: 100%;
        margin-bottom: 6px;
      }
  /* フォームの削除ボタンも同じように */
      form button {
        width: 100%;
        margin-bottom: 6px;
      }
    }

</style>

</head>
<body>
  <h1>時間割</h1>
  <div class="table-wrapper"></div>
    <table>
      <tr>
        <th>時限＼曜日</th>
        {% for day in days %}
          <th>{{ day }}</th>
        {% endfor %}
      </tr>
      {% for period in periods %}
      <tr>
        <th>{{ period }}限</th>
        {% for day in days %}
      <td
        {% if timetable[day][period] and timetable[day][period]['unsubmitted'] > 0 %}
          style="background-color:
            {% if timetable[day][period]['overdue'] %}
              mistyrose;
            {% else %}
              #fffacd;
            {% endif %}"
          {% endif %}
      >
          {% if timetable[day][period] %}
          {{ timetable[day][period]['name'] }}（{{ timetable[day][period]['room'] }}）<br>
          {% if timetable[day][period]['unsubmitted'] > 0 %}
            <span style="color: red;">未提出: {{ timetable[day][period]['unsubmitted'] }}件</span><br>
            {% if timetable[day][period]['overdue'] %}
              <span style="color: darkred; font-weight: bold;">⚠︎締切超過あり</span><br>
            {% endif %}
          {% endif %}

          <a href="{{ url_for('view_attendance', class_id=timetable[day][period]['id']) }}">
            <button style="background-color: lightgreen;">出席</button>
          </a>
          <a href="{{ url_for('evaluation', class_id=timetable[day][period]['id']) }}">
            <button style="background-color: lightskyblue;">評価</button>
          </a>
          <a href="{{ url_for('assignments', class_id=timetable[day][period]['id']) }}">
            <button style="background-color: orange;">課題</button>
          </a>
          <a href="{{ url_for('edit_class', class_id=timetable[day][period]['id']) }}">
            <button style="background-color: lightgray;">編集</button>
          </a>
          <form method="POST" action="{{ url_for('delete_class', class_id=timetable[day][period]['id']) }}" style="display: inline;">
            <button type="submit" style="background-color: salmon;">削除</button>
          </form>

        {% else %}
          -
        {% endif %}
      </td>

        {% endfor %}
      </tr>
      {% endfor %}
    </table>
  </div>
  <br />
  <a href="/add_class">授業を追加する</a>
</body>
</html>
